# Module 1: Microsoft R Server and Microsoft R Client

# Lab: Exploring Microsoft R Server and Microsoft R Client

### Scenario
You work as a data scientist for the Department of Transportation. You are investigating how and when domestic airline flights are delayed. The department wish to provide information that could help to minimize such delays and the consequent passenger frustration. You have a dataset containing flight delay information for a number of years, starting in 2000. Your task is to determine whether there are any specific patterns that occur in this data. Can these patterns be used to help predict when flight delays are likely to occur?

You have been given a small subset of the flight delay data for the year 2000 as a local CSV file. You wish to quickly examine its contents and schema to gain familiarity with the structure of the data and the tools that you are going to use.

### Objectives
In this lab, you will:
- Use R Client in Visual Studio (RTVS), or RStudio.
- Use ScaleR functions to perform some basic analyses.
- Perform analysis operations on a remote R server.

### Lab Setup
Estimated Time: 45 minutes
Username: **Adatum\\AdatumAdmin**
Password: **Pa55w.rd**

Before starting this lab, ensure that the following VMs are all running:
- MT17B-WS2016-NAT
- 20773A-LON-DC
- 20773A-LON-DEV
- 20773A-LON-RSVR
- 20773A-LON-SQLR

## Exercise 1: Using R Client in RTVS and RStudio

### Scenario
You wish to gain some familiarity with your development environment, and also take some time to look at a small part of the flight delay data—just so that you can assess the structure and data that it contains. You decide to use base R functions while you are getting used to the environment.

The main tasks for this exercise are as follows:
1. Start the development environment and create a new R script
2. Use the development environment to examine data

#### Task 1: Start the development environment and create a new R script
1. Log in to the **LON-DEV** VM as **Adatum\\AdatumAdmin** with the password **Pa55w.rd**.
2. Start your R development environment of choice (Visual Studio, or RStudio), and create a new R file.

#### Task 2: Use the development environment to examine data
1. The data file you will be using, **2000.csv**, is located in the **E:\\Labfiles\\Lab01** folder. Set your working directory to this folder.
2. Read the **2000.csv** file into a data frame and look at the first 10 rows. Use the base R **read.csv** function and the **head** function, rather than the ScaleR functions.
3. The data frame has a column named **Month** that contains the month number. Add a factor column to the data frame called **MonthName** that contains the corresponding month name. You can find month names in the **month.name** list. You should use the base R **factor** and **lapply** functions.
4. Generate a summary of the data frame using the **summary** function. Time how long it takes to perform this operation using the **system.time** function.
5. Examine the data frame as follows:
 -   Display the name of each column.
 -   Display the number of rows in the data frame.
 -   Find the minimum value in the **ArrDelay** column. This column records the flight arrival delay time in minutes.
 -   Find the maximum flight arrival delay.
6. Use the **xtabs** function to generate a cross tabulation showing the number of flights cancelled and not cancelled for each month. The **Cancellation** column contains a value indicating whether a flight was cancelled (1 – cancelled, 0 – not cancelled).
Note: Strictly speaking, **xtabs** is not a base R function, but it is commonly used by data scientists performing cross tabulations.

>**Note:** Record the console output, as this will be referenced in a later exercise.

**Results**: At the end of this exercise, you will have used either RTVS or RStudio to examine a subset of the flight delay data for the year 2000.

**Question:** How many columns are there in the data frame, including the new **MonthName** column?

**Question:** How many columns are there in the data frame?

**Question:** What are the minimum and maximum arrival delay times recorded in the data frame?

**Question:** How many flights were cancelled in June?

## Exercise 2: Exploring ScaleR functions

### Scenario
Now that you have an understanding of the shape of the data, you want to analyze it using the ScaleR functions. This gives you the opportunity to gain some familiarity with these functions. You can also verify that you are using them correctly because the values they return should be the same as those generated by using the base R functions.

The main tasks for this exercise are as follows:
1. Examine the data by using ScaleR functions

#### Task 1: Examine the data by using ScaleR functions
1.  Generate a summary of the data frame using the **rxSummary** function with the formula **~.** . This formula generates a summary for all numeric columns and factors in the data frame. Time how long it takes to perform this operation using the **system.time** function, and compare the time taken to that consumed by running the summary function over the same data frame in the previous exercise.
2. Run the **rxGetInfo** function over the data frame. This function retrieves the number of variables and observations in the data frame. Verify that these values are the same as those you obtained in exercise 1.
3. Run the **rxGetVarInfo** function over the data frame. This function retrieves more detailed information about the variables in the data frame, such as their names and type. Verify that the **MonthName** variable is a factor with 12 levels, each named after a month.
4. Run the **rxQuantile** function over the data frame. Specify the **ArrDelay** column as the first argument and the data frame as the second. This function reports the quantiles for the data. The 0% quantile should be the same as the minimum value reported earlier, and the 100% quantile should be the maximum value.
5. Use the **rxCrossTabs** function to generate a cross tabulation of the number of cancelled/not cancelled flights by month name. Use the formula **~MonthName:as.factor(Cancelled == 1)**.
Note that **rxCrossTabs** uses the ":" character to separate independent variables, rather than the "+" of **xtabs**.
6. Use the **rxCube** function to generate a data cube over the same data. Verify that the values displayed are the same as the cross tabulation.
7. Remove the data frame from session memory.

>**Note:** Please note the console output, as this will be compared too in a later exercise.

**Results**: At the end of this exercise, you will have used the ScaleR functions to examine the flight delay data for the year 2000, and compared the results against those generated by using the ScaleR functions.

## Exercise 3: Performing operations on a remote server

### Scenario
The data you have used so far is small enough to be analyzed locally, but you know that the entire dataset will be much too big to do this, and will require R Server resources. You decide to test that you can successfully connect to a remote server, perform operations, and retrieve the results back to a local session.

The main tasks for this exercise are as follows:
1. Copy the data to the remote server
2. Read the data into a data frame
3. Examine the data remotely
4. Transfer the results from the remote session

#### Task 1: Copy the data to the remote server

1.  Create a remote session on the LON-RSVR server. This is another VM running R Server. Use the following parameters to the **remoteLogin** function:
 -   deployr\_endpoint: **http://LON-RSVR.ADATUM.COM:12800**
 -   session: **TRUE**
 -   diff: **TRUE**
 -   commandLine: **TRUE**
 -   username: **admin**
 -   password: **Pa55w.rd**

2. Pause the remote session and return to the local session.
3. Copy the file **2000.csv** to the remote session. Use the **putLocalFile** function.
Note: For large files, you should perform this step as an out-of-band task and manually place the data on a network share that all files in the R Server cluster can access.
4. Return to the remote session.

#### Task 2: Read the data into a data frame
1. In the remote session, read the data into a data frame. Use the same code that you utilized in exercise 1.
2. Add the **MonthName** column to the data frame as you did in exercise 1.
3. Display the first 10 rows of the data using the **head** function.

#### Task 3: Examine the data remotely
- Repeat the operations that you performed in exercise 2 (**rxSummary**, **rxGetInfo**, **rxGetVarInfo**, **rxQuantile**, **rxCrossTab**, and **rxCube**), but save the results for each function in variables in the session.

####  Task 4: Transfer the results from the remote session
1.  Pause the remote session.
2. Copy the variables that you created in the remote session to the local session using the **getRemoteObject** function.
3. Print the variables you have just retrieved. Their contents should match the results you obtained in exercise 2.
4. Log out of the remote session.
5. Save the script as **Lab1Script.R** in the **E:\\Labfiles\\Lab01** folder, and close your R development environment.

**Results**: At the end of this exercise, you will have used the ScaleR functions to examine the flight delay data for the year 2000, and compared the results against those generated by using the ScaleR functions.

©2017 Microsoft Corporation. All rights reserved.

The text in this document is available under the [Creative Commons Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/legalcode), additional terms may apply. All other content contained in this document (including, without limitation, trademarks, logos, images, etc.) are **not** included within the Creative Commons license grant. This document does not provide you with any legal rights to any intellectual property in any Microsoft product. You may copy and use this document for your internal, reference purposes.

This document is provided "as-is." Information and views expressed in this document, including URL and other Internet Web site references, may change without notice. You bear the risk of using it. Some examples are for illustration only and are fictitious. No real association is intended or inferred. Microsoft makes no warranties, express or implied, with respect to the information provided here.
